
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.preprocessing import StandardScaler
from sklearn.cluster import KMeans, AgglomerativeClustering
from sklearn.metrics import silhouette_score
 
df = pd.read_csv("Mall_Customers.csv")
X_raw = df[['Annual Income (k$)', 'Spending Score (1-100)']].copy()
 
scaler = StandardScaler()
X = scaler.fit_transform(X_raw)
 
inertias = []
sil_scores = []
K_range = range(2, 11)
for k in K_range:
    km = KMeans(n_clusters=k, random_state=42, n_init=10)
    labels = km.fit_predict(X)
    inertias.append(km.inertia_)
    sil_scores.append(silhouette_score(X, labels))
 
plt.figure(figsize=(10,4))
plt.subplot(1,2,1)
plt.plot(list(K_range), inertias, '-o')
plt.xlabel('k'); plt.ylabel('Inertia'); plt.title('Elbow method')
plt.subplot(1,2,2)
plt.plot(list(K_range), sil_scores, '-o')
plt.xlabel('k'); plt.ylabel('Silhouette score'); plt.title('Silhouette vs k')
plt.tight_layout()
plt.show()
 
best_k = K_range[int(sil_scores.index(max(sil_scores)))]
print("Best k by silhouette:", best_k)
 
kmeans = KMeans(n_clusters=best_k, random_state=42, n_init=10).fit(X)
hc = AgglomerativeClustering(n_clusters=best_k).fit(X)
 
df['kmeans_cluster'] = kmeans.labels_
df['hier_cluster'] = hc.labels_
 
plt.figure(figsize=(12,5))
plt.subplot(1,2,1)
sns.scatterplot(x='Annual Income (k$)', y='Spending Score (1-100)', hue='kmeans_cluster',
                palette='tab10', data=df, legend='full')
plt.title(f'KMeans clusters (k={best_k})')
 
plt.subplot(1,2,2)
sns.scatterplot(x='Annual Income (k$)', y='Spending Score (1-100)', hue='hier_cluster',
                palette='tab10', data=df, legend='full')
plt.title(f'Hierarchical clusters (k={best_k})')
 
plt.tight_layout()
plt.show()
 
kmeans_sil = silhouette_score(X, kmeans.labels_)
hier_sil = silhouette_score(X, hc.labels_)
print(f"KMeans silhouette: {kmeans_sil:.4f}")
print(f"Hierarchical silhouette: {hier_sil:.4f}")
 